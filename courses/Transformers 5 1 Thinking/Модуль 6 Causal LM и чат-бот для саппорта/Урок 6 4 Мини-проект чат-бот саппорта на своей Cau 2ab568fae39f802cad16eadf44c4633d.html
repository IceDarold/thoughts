<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>–£—Ä–æ–∫ 6.4. –ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç: —á–∞—Ç-–±–æ—Ç —Å–∞–ø–ø–æ—Ä—Ç–∞ –Ω–∞ —Å–≤–æ–µ–π Causal LM</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 10px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.collection-content td {
	white-space: pre-wrap;
	word-break: break-word;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.callout img.notion-static-icon {
	width: 1em;
	height: 1em;
}

.callout p {
	margin: 0;
}

.callout h1,
.callout h2,
.callout h3 {
	margin: 0 0 0.6rem;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

blockquote.quote-large {
	font-size: 1.25em;
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(44, 44, 43, 1);
}
.highlight-gray {
	color: rgba(125, 122, 117, 1);
	fill: rgba(125, 122, 117, 1);
}
.highlight-brown {
	color: rgba(159, 118, 90, 1);
	fill: rgba(159, 118, 90, 1);
}
.highlight-orange {
	color: rgba(210, 123, 45, 1);
	fill: rgba(210, 123, 45, 1);
}
.highlight-yellow {
	color: rgba(203, 148, 52, 1);
	fill: rgba(203, 148, 52, 1);
}
.highlight-teal {
	color: rgba(80, 148, 110, 1);
	fill: rgba(80, 148, 110, 1);
}
.highlight-blue {
	color: rgba(56, 125, 201, 1);
	fill: rgba(56, 125, 201, 1);
}
.highlight-purple {
	color: rgba(154, 107, 180, 1);
	fill: rgba(154, 107, 180, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(207, 81, 72, 1);
	fill: rgba(207, 81, 72, 1);
}
.highlight-default_background {
	color: rgba(44, 44, 43, 1);
}
.highlight-gray_background {
	background: rgba(42, 28, 0, 0.07);
}
.highlight-brown_background {
	background: rgba(139, 46, 0, 0.086);
}
.highlight-orange_background {
	background: rgba(224, 101, 1, 0.129);
}
.highlight-yellow_background {
	background: rgba(211, 168, 0, 0.137);
}
.highlight-teal_background {
	background: rgba(0, 100, 45, 0.09);
}
.highlight-blue_background {
	background: rgba(0, 124, 215, 0.094);
}
.highlight-purple_background {
	background: rgba(102, 0, 178, 0.078);
}
.highlight-pink_background {
	background: rgba(197, 0, 93, 0.086);
}
.highlight-red_background {
	background: rgba(223, 22, 0, 0.094);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(125, 122, 117, 1);
	fill: rgba(125, 122, 117, 1);
}
.block-color-brown {
	color: rgba(159, 118, 90, 1);
	fill: rgba(159, 118, 90, 1);
}
.block-color-orange {
	color: rgba(210, 123, 45, 1);
	fill: rgba(210, 123, 45, 1);
}
.block-color-yellow {
	color: rgba(203, 148, 52, 1);
	fill: rgba(203, 148, 52, 1);
}
.block-color-teal {
	color: rgba(80, 148, 110, 1);
	fill: rgba(80, 148, 110, 1);
}
.block-color-blue {
	color: rgba(56, 125, 201, 1);
	fill: rgba(56, 125, 201, 1);
}
.block-color-purple {
	color: rgba(154, 107, 180, 1);
	fill: rgba(154, 107, 180, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(207, 81, 72, 1);
	fill: rgba(207, 81, 72, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(240, 239, 237, 1);
}
.block-color-brown_background {
	background: rgba(245, 237, 233, 1);
}
.block-color-orange_background {
	background: rgba(251, 235, 222, 1);
}
.block-color-yellow_background {
	background: rgba(249, 243, 220, 1);
}
.block-color-teal_background {
	background: rgba(232, 241, 236, 1);
}
.block-color-blue_background {
	background: rgba(229, 242, 252, 1);
}
.block-color-purple_background {
	background: rgba(243, 235, 249, 1);
}
.block-color-pink_background {
	background: rgba(250, 233, 241, 1);
}
.block-color-red_background {
	background: rgba(252, 233, 231, 1);
}
.select-value-color-default { background-color: rgba(42, 28, 0, 0.07); }
.select-value-color-gray { background-color: rgba(28, 19, 1, 0.11); }
.select-value-color-brown { background-color: rgba(127, 51, 0, 0.156); }
.select-value-color-orange { background-color: rgba(196, 88, 0, 0.203); }
.select-value-color-yellow { background-color: rgba(209, 156, 0, 0.282); }
.select-value-color-green { background-color: rgba(0, 96, 38, 0.156); }
.select-value-color-blue { background-color: rgba(0, 118, 217, 0.203); }
.select-value-color-purple { background-color: rgba(92, 0, 163, 0.141); }
.select-value-color-pink { background-color: rgba(183, 0, 78, 0.152); }
.select-value-color-red { background-color: rgba(206, 24, 0, 0.164); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="2ab568fa-e39f-802c-ad16-eadf44c4633d" class="page sans"><header><h1 class="page-title">–£—Ä–æ–∫ 6.4. –ú–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç: —á–∞—Ç-–±–æ—Ç —Å–∞–ø–ø–æ—Ä—Ç–∞ –Ω–∞ —Å–≤–æ–µ–π Causal LM</h1><p class="page-description"></p></header><div class="page-body"><p id="2ab568fa-e39f-80db-bfe4-ea6a3e2fde0a" class="">–û–∫–µ–π, –≤–æ—Ç —Ç—É—Ç –º—ã —É–∂–µ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å—ë –≤ <strong>–∂–∏–≤–æ–≥–æ –±–æ—Ç–∞</strong>, –∞ –Ω–µ –≤ ‚Äú–ø–æ—Å—Ç—Ä–µ–ª—è–ª–∏ –≤ generate –∏ —Ä–∞–∑–æ—à–ª–∏—Å—å‚Äù üòÑ</p><p id="2ab568fa-e39f-8023-b0f4-f3d474885034" class="">–ù–∏–∂–µ ‚Äî <strong>–ø–æ–ª–Ω—ã–π —É—Ä–æ–∫ 6.4</strong>: —Ç–µ–æ—Ä–∏—è, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–æ–ª–Ω—ã–π –∫–æ–¥ —á–∞—Ç-–±–æ—Ç–∞ —Å–∞–ø–ø–æ—Ä—Ç–∞ + —Ä–∞–∑–±–æ—Ä.</p><hr id="2ab568fa-e39f-8074-82a8-cb5a92765c8f"/><h2 id="2ab568fa-e39f-8009-960c-ea9ebbbf7659" class="">0. –¶–µ–ª–∏ —É—Ä–æ–∫–∞</h2><p id="2ab568fa-e39f-8081-90f5-e0a4825af509" class="">–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ —É—á–µ–Ω–∏–∫ —Å–º–æ–∂–µ—Ç:</p><ul id="2ab568fa-e39f-80f0-9871-c994b2961d24" class="bulleted-list"><li style="list-style-type:disc">–≤–∑—è—Ç—å –¥–æ–æ–±—É—á–µ–Ω–Ω—É—é –≤ 6.3 –º–æ–¥–µ–ª—å (<code>support_causal_sft</code>),</li></ul><ul id="2ab568fa-e39f-806e-8ce3-e048ce2bf98f" class="bulleted-list"><li style="list-style-type:disc">–æ–±–µ—Ä–Ω—É—Ç—å –µ—ë –≤ <strong>—á–∞—Ç-–±–æ—Ç–∞</strong>:<ul id="2ab568fa-e39f-809d-9c37-dcd7d43274ff" class="bulleted-list"><li style="list-style-type:circle">—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞,</li></ul><ul id="2ab568fa-e39f-8068-a94d-c28e3cbbc3bb" class="bulleted-list"><li style="list-style-type:circle">–∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –ø—Ä–æ–º–ø—Ç –ø–æ–¥ Causal LM,</li></ul><ul id="2ab568fa-e39f-80ed-a8e8-f2f3e1cffc55" class="bulleted-list"><li style="list-style-type:circle">–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥–ª–∏–Ω—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞,</li></ul><ul id="2ab568fa-e39f-807f-aa7f-cbb205cd8be5" class="bulleted-list"><li style="list-style-type:circle">–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã —Å –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏;</li></ul></li></ul><ul id="2ab568fa-e39f-80d9-8281-fd4627cf72a6" class="bulleted-list"><li style="list-style-type:disc">–∑–∞–ø—É—Å–∫–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ;</li></ul><ul id="2ab568fa-e39f-8067-99c1-ec6cea0b7a89" class="bulleted-list"><li style="list-style-type:disc">–ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –Ω—É–∂–Ω—ã, —á—Ç–æ–±—ã –ø—Ä–∏–±–ª–∏–∂–∞—Ç—å —ç—Ç–æ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É.</li></ul><hr id="2ab568fa-e39f-8036-917d-d0a9c2ec88d1"/><h2 id="2ab568fa-e39f-80ef-8d14-d55f17d00c26" class="">1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞—à–µ–≥–æ –º–∏–Ω–∏-–±–æ—Ç–∞</h2><p id="2ab568fa-e39f-808a-ac21-e815c9f7de8a" class="">–ß–µ–≥–æ –≤–æ–æ–±—â–µ —Ö–æ—Ç–∏–º:</p><blockquote id="2ab568fa-e39f-8063-9e24-e26fdf31f310" class="">–°–∫—Ä–∏–ø—Ç support_bot.py, –∫–æ—Ç–æ—Ä—ã–π:<ul id="2ab568fa-e39f-806c-ab84-cd648b3f6acd" class="bulleted-list"><li style="list-style-type:disc">–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä + SFT-–º–æ–¥–µ–ª—å,</li></ul><ul id="2ab568fa-e39f-8070-a2b9-fe5e3306d777" class="bulleted-list"><li style="list-style-type:disc">–¥–µ—Ä–∂–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ (<code>messages</code>),</li></ul><ul id="2ab568fa-e39f-80de-a80c-ee3016962bd2" class="bulleted-list"><li style="list-style-type:disc">–Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ:<ul id="2ab568fa-e39f-80ab-bfb6-f42319bec6f6" class="bulleted-list"><li style="list-style-type:circle">–¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–ø–ª–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,</li></ul><ul id="2ab568fa-e39f-800b-91a6-d259fc3e5b0e" class="bulleted-list"><li style="list-style-type:circle">—Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–º–ø—Ç,</li></ul><ul id="2ab568fa-e39f-8089-a38c-dc7ad5b2fa77" class="bulleted-list"><li style="list-style-type:circle">–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç,</li></ul><ul id="2ab568fa-e39f-809b-923c-f31c45e1bc98" class="bulleted-list"><li style="list-style-type:circle">–¥–æ–±–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é.</li></ul></li></ul></blockquote><p id="2ab568fa-e39f-8062-beaf-c1be94d52af1" class="">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:</p><ol type="1" id="2ab568fa-e39f-8090-9b58-e4b43a0cc11c" class="numbered-list" start="1"><li>–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã/–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:<ul id="2ab568fa-e39f-8003-ac16-d7f06f1e876b" class="bulleted-list"><li style="list-style-type:disc"><code>MODEL_DIR</code> = –ø—É—Ç—å –∫ –¥–æ–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏–∑ 6.3.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-8096-89cd-c7d1ac9d2e4c" class="numbered-list" start="2"><li>–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞:<ul id="2ab568fa-e39f-809a-bee0-d2e6c1e3831b" class="bulleted-list"><li style="list-style-type:disc"><code>messages: List[{&quot;role&quot;: ..., &quot;content&quot;: ...}]</code>.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-8047-ac28-dd2646a6d3ad" class="numbered-list" start="3"><li><code>build_prompt(messages, max_turns)</code>:<ul id="2ab568fa-e39f-80d9-8a2e-ef5c24fa947a" class="bulleted-list"><li style="list-style-type:disc">–±–µ—Ä—ë—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Ä–µ–ø–ª–∏–∫,</li></ul><ul id="2ab568fa-e39f-80d8-9270-f71ba16e2d3e" class="bulleted-list"><li style="list-style-type:disc">–¥–æ–±–∞–≤–ª—è–µ—Ç <code>&quot;Support:&quot;</code> –≤ –∫–æ–Ω—Ü–µ.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-80e4-b623-f5ce07301113" class="numbered-list" start="4"><li><code>generate_reply(model, tokenizer, messages, ...)</code>:<ul id="2ab568fa-e39f-80b1-905a-cb01093157e5" class="bulleted-list"><li style="list-style-type:disc">—Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–º–ø—Ç,</li></ul><ul id="2ab568fa-e39f-80ad-bbab-e7c1af2c74bf" class="bulleted-list"><li style="list-style-type:disc">–¥–µ–ª–∞–µ—Ç <code>.generate</code>,</li></ul><ul id="2ab568fa-e39f-8055-b531-d1de59550a36" class="bulleted-list"><li style="list-style-type:disc">–≤—ã–¥—ë—Ä–≥–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-8036-a34d-f32cdaccd9e5" class="numbered-list" start="5"><li><code>chat()</code>:<ul id="2ab568fa-e39f-8050-aa38-fdddd7952ee5" class="bulleted-list"><li style="list-style-type:disc">REPL-–ª—É–ø: <code>input()</code> ‚Üí –≤—ã–∑–æ–≤ <code>generate_reply</code> ‚Üí –ø–µ—á–∞—Ç—å ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ <code>messages</code>.</li></ul></li></ol><hr id="2ab568fa-e39f-8009-baf3-e54d3e2d8187"/><h2 id="2ab568fa-e39f-805f-a2e6-e627dee9a4df" class="">2. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å (–∏–∑ —É—Ä–æ–∫–∞ 6.3)</h2><p id="2ab568fa-e39f-8019-b029-fb43fbafa1a6" class="">–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –ø–æ—Å–ª–µ 6.3 —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2ab568fa-e39f-8050-8ea6-e574026b575c" class="code code-wrap"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">models/support_causal_sft/
  - config.json
  - pytorch_model.bin
  - tokenizer.json / vocab.json / merges.txt –∏ —Ç.–ø.
</code></pre><h3 id="2ab568fa-e39f-801e-b6fc-ee2e46c4891e" class="">2.1. –ë–∞–∑–æ–≤—ã–π –∫–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2ab568fa-e39f-80e6-bf3d-d05daa4646ee" class="code code-wrap"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">import torch
from transformers import AutoTokenizer, AutoModelForCausalLM

MODEL_DIR = &quot;models/support_causal_sft&quot;  # –ø—É—Ç—å –∫ —Ç–≤–æ–µ–π –¥–æ–æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

tokenizer = AutoTokenizer.from_pretrained(MODEL_DIR)
model = AutoModelForCausalLM.from_pretrained(MODEL_DIR)

if tokenizer.pad_token is None:
    tokenizer.pad_token = tokenizer.eos_token

device = torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)
model.to(device)
</code></pre><p id="2ab568fa-e39f-8036-8209-cc4c10024a0f" class="">–ü–æ—è—Å–Ω–µ–Ω–∏–µ:</p><ul id="2ab568fa-e39f-804c-9c8c-c5c61df0e09b" class="bulleted-list"><li style="list-style-type:disc"><code>from_pretrained(MODEL_DIR)</code> ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∏–º–µ–Ω–Ω–æ —Ç–≤–æ–µ–π SFT-–º–æ–¥–µ–ª–∏, –∞ –Ω–µ –±–∞–∑–æ–≤–æ–π GPT-2.</li></ul><ul id="2ab568fa-e39f-8001-98d6-f6baa6351934" class="bulleted-list"><li style="list-style-type:disc">pad-—Ç–æ–∫–µ–Ω –ø–æ–¥—Å—Ç—Ä–∞—Ö–æ–≤—ã–≤–∞–µ–º, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ.</li></ul><ul id="2ab568fa-e39f-80ce-8c86-e5d32f2161c0" class="bulleted-list"><li style="list-style-type:disc">–º–æ–¥–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ GPU, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω.</li></ul><hr id="2ab568fa-e39f-804c-b8da-e66ea563d6fa"/><h2 id="2ab568fa-e39f-805c-bd8d-cdb474a95c71" class="">3. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–º–ø—Ç–∞: <code>build_prompt(messages, max_turns)</code></h2><p id="2ab568fa-e39f-80be-865c-e189e90ecf8f" class="">–ú—ã —Ö–æ—Ç–∏–º:</p><ul id="2ab568fa-e39f-8043-95c2-e5af75f92ca5" class="bulleted-list"><li style="list-style-type:disc">—Ö—Ä–∞–Ω–∏—Ç—å –í–°–Æ –∏—Å—Ç–æ—Ä–∏—é, –Ω–æ <strong>–≤ –ø—Ä–æ–º–ø—Ç –æ—Ç–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ö–≤–æ—Å—Ç</strong> (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Ä–µ–ø–ª–∏–∫),</li></ul><ul id="2ab568fa-e39f-80f7-83ba-c43370ce4830" class="bulleted-list"><li style="list-style-type:disc">–≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å system-—Å–æ–æ–±—â–µ–Ω–∏–µ,</li></ul><ul id="2ab568fa-e39f-8097-8d75-cd5d97cc4bbd" class="bulleted-list"><li style="list-style-type:disc">–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç, –∫–∞–∫ –≤ SFT:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2ab568fa-e39f-80ba-8a96-da5225043e3b" class="code code-wrap"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">System: ...
User: ...
Support: ...
</code></pre></li></ul><h3 id="2ab568fa-e39f-804c-ab73-ccfcad225dc2" class="">3.1. –§—É–ª–ª —Ñ—É–Ω–∫—Ü–∏—è</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2ab568fa-e39f-8062-9ccb-ecbdc3853708" class="code code-wrap"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">def build_prompt(messages, max_turns: int = 6) -&gt; str:
    &quot;&quot;&quot;
    –°–æ–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ messages.
    - messages: —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π {&quot;role&quot;: &quot;system&quot;|&quot;user&quot;|&quot;assistant&quot;, &quot;content&quot;: str}
    - max_turns: —Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ù–ï-system —Å–æ–æ–±—â–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.
    –§–æ—Ä–º–∞—Ç:
    System: ...
    User: ...
    Support: ...
    ...
    Support:  &lt;-- –Ω–∞ —ç—Ç–æ–º –º–µ—Å—Ç–µ –º–æ–¥–µ–ª—å –Ω–∞—á–Ω—ë—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
    &quot;&quot;&quot;

    # 1. –í—ã–¥–µ–ª—è–µ–º system –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    system_messages = [m for m in messages if m[&quot;role&quot;] == &quot;system&quot;]
    other_messages = [m for m in messages if m[&quot;role&quot;] != &quot;system&quot;]

    # 2. –ë–µ—Ä—ë–º –º–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ system-—Å–æ–æ–±—â–µ–Ω–∏–µ
    system_part = system_messages[:1]

    # 3. –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ max_turns –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    other_part = other_messages[-max_turns:]

    # 4. –°–∫–ª–µ–∏–≤–∞–µ–º –≤ –∏—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ—Ä—è–¥–æ–∫
    use_messages = system_part + other_part

    lines = []
    for msg in use_messages:
        role = msg[&quot;role&quot;]
        content = msg[&quot;content&quot;].strip()

        if role == &quot;system&quot;:
            lines.append(f&quot;System: {content}&quot;)
        elif role == &quot;user&quot;:
            lines.append(f&quot;User: {content}&quot;)
        elif role in (&quot;assistant&quot;, &quot;support&quot;):
            lines.append(f&quot;Support: {content}&quot;)
        else:
            lines.append(f&quot;{role.capitalize()}: {content}&quot;)

    # 5. –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ —Å–∞–ø–ø–æ—Ä—Ç–∞
    prompt = &quot;\n&quot;.join(lines) + &quot;\nSupport:&quot;

    return prompt
</code></pre><p id="2ab568fa-e39f-808a-94bb-fb86f41535b4" class=""><strong>–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:</strong></p><ul id="2ab568fa-e39f-8033-b233-da35f1331b4b" class="bulleted-list"><li style="list-style-type:disc"><code>max_turns</code> ‚Äî —Ä–µ–≥—É–ª–∏—Ä—É–µ—à—å –±–∞–ª–∞–Ω—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:<ul id="2ab568fa-e39f-803e-ad41-da6f9a58ba0d" class="bulleted-list"><li style="list-style-type:circle">–º–∞–ª–µ–Ω—å–∫–æ–µ ‚Üí –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç ‚Äú–∑–∞–±—ã–≤–∞—Ç—å‚Äù —Ç–æ, —á—Ç–æ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ;</li></ul><ul id="2ab568fa-e39f-80bf-a2ea-db93aa176bb3" class="bulleted-list"><li style="list-style-type:circle">–±–æ–ª—å—à–æ–µ ‚Üí –º–æ–∂–µ—à—å —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.</li></ul></li></ul><ul id="2ab568fa-e39f-80ba-b78a-fbc522374353" class="bulleted-list"><li style="list-style-type:disc">–ú—ã <strong>–≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º</strong> –æ–¥–∏–Ω system (–µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å).</li></ul><ul id="2ab568fa-e39f-80a1-9534-f508405d1b3a" class="bulleted-list"><li style="list-style-type:disc">–í –∫–æ–Ω—Ü–µ <strong>–≤—Å–µ–≥–¥–∞</strong> –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º <code>Support:</code> ‚Äî –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ.</li></ul><hr id="2ab568fa-e39f-80cc-badf-f5f4b04bf0ba"/><h2 id="2ab568fa-e39f-8077-820e-c83d02f0d224" class="">4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞: <code>generate_reply(...)</code></h2><p id="2ab568fa-e39f-806d-a2a3-f1db3ed490ee" class="">–ó–∞–¥–∞—á–∞ —Ñ—É–Ω–∫—Ü–∏–∏:</p><ol type="1" id="2ab568fa-e39f-80d0-b6ae-e19681e54268" class="numbered-list" start="1"><li>–ü–æ–ª—É—á–∏—Ç—å <code>messages</code>.</li></ol><ol type="1" id="2ab568fa-e39f-804c-adbd-d19a8244cbc7" class="numbered-list" start="2"><li>–°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–º–ø—Ç.</li></ol><ol type="1" id="2ab568fa-e39f-8088-b3be-e90a9a0d45f8" class="numbered-list" start="3"><li>–ü—Ä–æ–≥–Ω–∞—Ç—å —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä.</li></ol><ol type="1" id="2ab568fa-e39f-80dc-8dc0-f29910711905" class="numbered-list" start="4"><li>–í—ã–∑–≤–∞—Ç—å <code>.generate()</code> —Å –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.</li></ol><ol type="1" id="2ab568fa-e39f-8063-9db1-f1447fb82d18" class="numbered-list" start="5"><li>–í–µ—Ä–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞.</li></ol><h3 id="2ab568fa-e39f-8081-afe0-e4a34161015f" class="">4.1. –§—É–ª–ª —Ñ—É–Ω–∫—Ü–∏—è</h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2ab568fa-e39f-80f3-be5a-d29e284b48d7" class="code code-wrap"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">def generate_reply(
    model,
    tokenizer,
    messages,
    max_new_tokens: int = 128,
    top_p: float = 0.9,
    temperature: float = 0.7,
    repetition_penalty: float = 1.1,
    max_input_length: int = 512,
) -&gt; str:
    &quot;&quot;&quot;
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ messages.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ (–±–µ–∑ –ø—Ä–æ–º–ø—Ç–∞).
    &quot;&quot;&quot;
    # 1. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–º–ø—Ç
    prompt = build_prompt(messages)

    # 2. –¢–æ–∫–µ–Ω–∏–∑–∏—Ä—É–µ–º —Å –æ–±—Ä–µ–∑–∫–æ–π –ø–æ –¥–ª–∏–Ω–µ
    inputs = tokenizer(
        prompt,
        return_tensors=&quot;pt&quot;,
        truncation=True,
        max_length=max_input_length,
    )
    inputs = {k: v.to(model.device) for k, v in inputs.items()}

    # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
    with torch.no_grad():
        output_ids = model.generate(
            **inputs,
            max_new_tokens=max_new_tokens,
            do_sample=True,
            top_p=top_p,
            temperature=temperature,
            repetition_penalty=repetition_penalty,
            eos_token_id=tokenizer.eos_token_id,
        )

    # 4. –í—ã–¥–µ–ª—è–µ–º —Ç–æ–ª—å–∫–æ &quot;–Ω–æ–≤—É—é&quot; —á–∞—Å—Ç—å (–æ—Ç–≤–µ—Ç)
    input_len = inputs[&quot;input_ids&quot;].shape[1]
    new_tokens = output_ids[0][input_len:]

    reply = tokenizer.decode(new_tokens, skip_special_tokens=True).strip()

    # 5. –ù–µ–º–Ω–æ–≥–æ –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –¥–æ–ø–∏—Å–∞–ª–∞ &quot;User:&quot; –∏ —Ç.–ø.)
    for marker in [&quot;User:&quot;, &quot;System:&quot;, &quot;Support:&quot;]:
        if marker in reply:
            reply = reply.split(marker)[0].strip()

    # 6. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É / fallback, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –ø—É—Å—Ç–æ
    if len(reply) == 0:
        reply = &quot;I&#x27;m sorry, I couldn&#x27;t generate a helpful answer. Let me connect you to a human agent.&quot;

    return reply
</code></pre><p id="2ab568fa-e39f-80ff-9b35-e56a9f7b847a" class=""><strong>–ß—Ç–æ —Ç—É—Ç –≤–∞–∂–Ω–æ:</strong></p><ul id="2ab568fa-e39f-808d-9591-d2a88cd6deaa" class="bulleted-list"><li style="list-style-type:disc"><code>truncation=True</code> + <code>max_length=max_input_length</code> ‚Äî –º—ã –Ω–µ –¥–∞—ë–º input‚Äô—É –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —Ä–∞—Å—Ç–∏.</li></ul><ul id="2ab568fa-e39f-8005-ae24-d60e576166ad" class="bulleted-list"><li style="list-style-type:disc"><code>do_sample=True</code> + <code>top_p</code> + <code>temperature</code> –¥–∞—é—Ç –∂–∏–≤–æ—Å—Ç—å.</li></ul><ul id="2ab568fa-e39f-8006-b14c-daa0793db545" class="bulleted-list"><li style="list-style-type:disc"><code>repetition_penalty</code> —á—É—Ç—å —Å–Ω–∏–∂–∞–µ—Ç —à–∞–Ω—Å –∑–∞–∏–∫–∞–Ω–∏–π.</li></ul><ul id="2ab568fa-e39f-8048-aa51-c363ecec1816" class="bulleted-list"><li style="list-style-type:disc">–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º ‚Äî –Ω–µ–±–æ–ª—å—à–æ–π –∫–æ—Å—Ç—ã–ª—å, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–∑–∞—Ç—å –≤—Å—ë, —á—Ç–æ –º–æ–¥–µ–ª—å –º–æ–≥–ª–∞ –¥–æ–ø–∏—Å–∞—Ç—å –¥–∞–ª—å—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—á–∞–ª–∞ —Å–Ω–æ–≤–∞ –ø–∏—Å–∞—Ç—å <code>User:</code>).</li></ul><ul id="2ab568fa-e39f-80f8-b11e-d2d25d0f4272" class="bulleted-list"><li style="list-style-type:disc">fallback –Ω–∞ –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è ‚Äú—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞‚Äù.</li></ul><hr id="2ab568fa-e39f-80bc-90c8-cb97afbebc3d"/><h2 id="2ab568fa-e39f-80fd-b973-e5dbafcbc134" class="">5. –ß–∞—Ç-–ª—É–ø: <code>chat()</code></h2><p id="2ab568fa-e39f-801b-b265-f1de17a440ec" class="">–¢–µ–ø–µ—Ä—å –≤—Å—ë —Å–∫–ª–µ–∏–≤–∞–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π —á–∞—Ç:</p><ul id="2ab568fa-e39f-80a5-88f8-efdd12126d4c" class="bulleted-list"><li style="list-style-type:disc">–∑–∞–¥–∞—ë–º system-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é,</li></ul><ul id="2ab568fa-e39f-80a5-af5f-caa33492768e" class="bulleted-list"><li style="list-style-type:disc">–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º <code>messages</code>,</li></ul><ul id="2ab568fa-e39f-80af-b840-dd77864e4402" class="bulleted-list"><li style="list-style-type:disc">–≤ —Ü–∏–∫–ª–µ —á–∏—Ç–∞–µ–º <code>user_input</code>,</li></ul><ul id="2ab568fa-e39f-808b-992e-f5fa42abbc18" class="bulleted-list"><li style="list-style-type:disc">–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –∏—Å—Ç–æ—Ä–∏—é.</li></ul><h3 id="2ab568fa-e39f-8004-ad77-c239db4ba311" class="">5.1. –ü–æ–ª–Ω—ã–π <code>support_bot.py</code></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2ab568fa-e39f-80e9-9f83-c0a39440deb8" class="code code-wrap"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">import torch
from transformers import AutoTokenizer, AutoModelForCausalLM


MODEL_DIR = &quot;models/support_causal_sft&quot;  # —Å—é–¥–∞ –ø–æ–ª–æ–∂–∏–ª–∏ –º–æ–¥–µ–ª—å –∏–∑ —É—Ä–æ–∫–∞ 6.3


def build_prompt(messages, max_turns: int = 6) -&gt; str:
    system_messages = [m for m in messages if m[&quot;role&quot;] == &quot;system&quot;]
    other_messages = [m for m in messages if m[&quot;role&quot;] != &quot;system&quot;]

    system_part = system_messages[:1]
    other_part = other_messages[-max_turns:]

    use_messages = system_part + other_part

    lines = []
    for msg in use_messages:
        role = msg[&quot;role&quot;]
        content = msg[&quot;content&quot;].strip()

        if role == &quot;system&quot;:
            lines.append(f&quot;System: {content}&quot;)
        elif role == &quot;user&quot;:
            lines.append(f&quot;User: {content}&quot;)
        elif role in (&quot;assistant&quot;, &quot;support&quot;):
            lines.append(f&quot;Support: {content}&quot;)
        else:
            lines.append(f&quot;{role.capitalize()}: {content}&quot;)

    prompt = &quot;\n&quot;.join(lines) + &quot;\nSupport:&quot;
    return prompt


def generate_reply(
    model,
    tokenizer,
    messages,
    max_new_tokens: int = 128,
    top_p: float = 0.9,
    temperature: float = 0.7,
    repetition_penalty: float = 1.1,
    max_input_length: int = 512,
) -&gt; str:
    prompt = build_prompt(messages)

    inputs = tokenizer(
        prompt,
        return_tensors=&quot;pt&quot;,
        truncation=True,
        max_length=max_input_length,
    )
    inputs = {k: v.to(model.device) for k, v in inputs.items()}

    with torch.no_grad():
        output_ids = model.generate(
            **inputs,
            max_new_tokens=max_new_tokens,
            do_sample=True,
            top_p=top_p,
            temperature=temperature,
            repetition_penalty=repetition_penalty,
            eos_token_id=tokenizer.eos_token_id,
        )

    input_len = inputs[&quot;input_ids&quot;].shape[1]
    new_tokens = output_ids[0][input_len:]
    reply = tokenizer.decode(new_tokens, skip_special_tokens=True).strip()

    for marker in [&quot;User:&quot;, &quot;System:&quot;, &quot;Support:&quot;]:
        if marker in reply:
            reply = reply.split(marker)[0].strip()

    if len(reply) == 0:
        reply = &quot;I&#x27;m sorry, I couldn&#x27;t generate a helpful answer. Let me connect you to a human agent.&quot;

    return reply


def chat():
    # 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å –∏ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä
    tokenizer = AutoTokenizer.from_pretrained(MODEL_DIR)
    model = AutoModelForCausalLM.from_pretrained(MODEL_DIR)

    if tokenizer.pad_token is None:
        tokenizer.pad_token = tokenizer.eos_token

    device = torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)
    model.to(device)

    # 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
    messages = [
        {
            &quot;role&quot;: &quot;system&quot;,
            &quot;content&quot;: &quot;You are a helpful and concise support assistant for a mobile app. &quot;
                       &quot;You answer briefly and politely, and ask for clarification when needed.&quot;,
        }
    ]

    print(&quot;Support bot is ready. Type &#x27;exit&#x27; or &#x27;quit&#x27; to stop.\n&quot;)

    # 3. –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
    while True:
        try:
            user_input = input(&quot;User: &quot;).strip()
        except (EOFError, KeyboardInterrupt):
            print(&quot;\nExiting chat.&quot;)
            break

        if user_input.lower() in {&quot;exit&quot;, &quot;quit&quot;} or len(user_input) == 0:
            print(&quot;Goodbye!&quot;)
            break

        # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–ø–ª–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∏—Å—Ç–æ—Ä–∏—é
        messages.append({&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input})

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
        reply = generate_reply(model, tokenizer, messages)

        print(&quot;Support:&quot;, reply)

        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
        messages.append({&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: reply})


if __name__ == &quot;__main__&quot;:
    chat()
</code></pre><hr id="2ab568fa-e39f-807d-b0a0-fa93b61d1f21"/><h2 id="2ab568fa-e39f-80ef-9f57-f36ca5b188a6" class="">6. –†–∞–∑–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π</h2><h3 id="2ab568fa-e39f-80d6-a59f-cd20312ced44" class="">6.1. –ü–æ—á–µ–º—É <code>max_turns</code> –≤ <code>build_prompt</code></h3><ul id="2ab568fa-e39f-801c-acd1-c522c75f159c" class="bulleted-list"><li style="list-style-type:disc"><strong>–ù–µ —Ö–æ—Ç–∏–º</strong> –¥–µ—Ä–∂–∞—Ç—å –≤–µ—Å—å –¥–∏–∞–ª–æ–≥ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ–º–ø—Ç–µ:<ul id="2ab568fa-e39f-80ef-91a2-c23e031bf425" class="bulleted-list"><li style="list-style-type:circle">–º–æ–¥–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –ø–æ –¥–ª–∏–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1024/2048 —Ç–æ–∫–µ–Ω–æ–≤),</li></ul><ul id="2ab568fa-e39f-802f-b01f-f857634156e3" class="bulleted-list"><li style="list-style-type:circle">—á–µ–º –¥–ª–∏–Ω–Ω–µ–µ input, —Ç–µ–º –¥–æ—Ä–æ–∂–µ –∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ.</li></ul></li></ul><ul id="2ab568fa-e39f-801f-af4e-d304771c71a9" class="bulleted-list"><li style="list-style-type:disc"><code>max_turns</code> ‚Äî –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:<ul id="2ab568fa-e39f-8006-ac84-f4356f8093db" class="bulleted-list"><li style="list-style-type:circle">–¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –±–æ—Ç–∞ —á–∞—Å—Ç–æ —Ö–≤–∞—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 4‚Äì8 —Ä–µ–ø–ª–∏–∫.</li></ul></li></ul><p id="2ab568fa-e39f-80ba-b78b-dcb4f94eafab" class="">–ú–æ–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:</p><ul id="2ab568fa-e39f-80aa-ba43-e0b91d817e0f" class="bulleted-list"><li style="list-style-type:disc"><code>max_turns=4</code> ‚Üí –±–æ—Ç –∏–Ω–æ–≥–¥–∞ ‚Äú–∑–∞–±—ã–≤–∞–µ—Ç‚Äù —Å—Ç–∞—Ä—ã–µ –¥–µ—Ç–∞–ª–∏;</li></ul><ul id="2ab568fa-e39f-80ea-a881-d61644992e9e" class="bulleted-list"><li style="list-style-type:disc"><code>max_turns=10</code> ‚Üí –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –Ω–æ –¥–æ—Ä–æ–∂–µ.</li></ul><hr id="2ab568fa-e39f-80ce-972e-f9573687e671"/><h3 id="2ab568fa-e39f-8058-ab3c-d6ddf2c8f33e" class="">6.2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h3><p id="2ab568fa-e39f-8090-b7eb-cfeb99b82eb8" class="">–í <code>generate_reply</code> –º—ã –≤—ã–±—Ä–∞–ª–∏:</p><ul id="2ab568fa-e39f-80ec-a61b-f0e7c8c8838e" class="bulleted-list"><li style="list-style-type:disc"><code>do_sample=True</code>,</li></ul><ul id="2ab568fa-e39f-8003-a68b-d456bc48380f" class="bulleted-list"><li style="list-style-type:disc"><code>top_p=0.9</code>, <code>temperature=0.7</code>,</li></ul><ul id="2ab568fa-e39f-80c4-9b41-dd80c077c82c" class="bulleted-list"><li style="list-style-type:disc"><code>repetition_penalty=1.1</code>.</li></ul><p id="2ab568fa-e39f-806b-a8da-d248c48ca961" class="">–≠—Ç–æ –¥–∞—ë—Ç:</p><ul id="2ab568fa-e39f-8041-a9db-cdab4f07c915" class="bulleted-list"><li style="list-style-type:disc">–±–æ–ª–µ–µ –∂–∏–≤—ã–µ, —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã,</li></ul><ul id="2ab568fa-e39f-804b-b004-e1d04b041cda" class="bulleted-list"><li style="list-style-type:disc">–º–µ–Ω—å—à–µ —Ç—É–ø—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤.</li></ul><p id="2ab568fa-e39f-80dd-8b1f-cac0f8db8c5c" class="">–ú–æ–∂–Ω–æ –¥–∞—Ç—å —É—á–µ–Ω–∏–∫–∞–º –ø–æ–∏–≥—Ä–∞—Ç—å—Å—è:</p><ul id="2ab568fa-e39f-8061-927e-db3c955e3d82" class="bulleted-list"><li style="list-style-type:disc"><code>temperature</code> 0.5 vs 1.0,</li></ul><ul id="2ab568fa-e39f-80a7-a70c-f97c252943da" class="bulleted-list"><li style="list-style-type:disc"><code>top_p</code> 0.8 vs 0.95,</li></ul><ul id="2ab568fa-e39f-8019-a2f1-c12deeba9624" class="bulleted-list"><li style="list-style-type:disc"><code>repetition_penalty</code> 1.0 vs 1.2.</li></ul><hr id="2ab568fa-e39f-80f5-9cf2-fee6e6ab85ee"/><h3 id="2ab568fa-e39f-80ba-bd95-f9f3fefa4ebe" class="">6.3. –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ reply</h3><p id="2ab568fa-e39f-804f-88d9-fb465ef2a7c3" class="">–°—Ä–µ–∑–∞–µ–º –ø–æ <code>[&quot;User:&quot;, &quot;System:&quot;, &quot;Support:&quot;]</code>:</p><ul id="2ab568fa-e39f-8099-b442-cf0a303008dd" class="bulleted-list"><li style="list-style-type:disc">Causal LM –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –¥–∏–∞–ª–æ–≥ –∏ –∑–∞ user, –∏ –∑–∞ system.</li></ul><ul id="2ab568fa-e39f-808d-8a2c-cbef2ab83571" class="bulleted-list"><li style="list-style-type:disc">–ú—ã —Ö–æ—Ç–∏–º —Ç–æ–ª—å–∫–æ <strong>–ø–µ—Ä–≤—ã–π –∫—É—Å–æ–∫ –æ—Ç–≤–µ—Ç–∞</strong>.</li></ul><ul id="2ab568fa-e39f-803a-8bbe-f87e3b901de0" class="bulleted-list"><li style="list-style-type:disc">–û–±—Ä–µ–∑–∫–∞ –ø–æ —ç—Ç–∏–º –º–∞—Ä–∫–µ—Ä–∞–º ‚Äî –ø—Ä–æ—Å—Ç–æ–π, –Ω–æ –¥–æ–≤–æ–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä.</li></ul><hr id="2ab568fa-e39f-8088-8f80-d50b613e4737"/><h3 id="2ab568fa-e39f-8085-a256-cc3dc01074af" class="">6.4. Fallback –Ω–∞ –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç</h3><p id="2ab568fa-e39f-808f-b31e-fb4037baeae8" class="">–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É:</p><ul id="2ab568fa-e39f-8067-a9fb-f2b8241f615b" class="bulleted-list"><li style="list-style-type:disc">–º—ã –Ω–µ —Ö–æ—Ç–∏–º –ø–µ—á–∞—Ç–∞—Ç—å —Ç–∏—à–∏–Ω—É,</li></ul><ul id="2ab568fa-e39f-80a0-838d-e8fac235a920" class="bulleted-list"><li style="list-style-type:disc">–ª—É—á—à–µ –≤—ã–≤–µ—Å—Ç–∏ –≤–µ–∂–ª–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–∏–ø–∞:<blockquote id="2ab568fa-e39f-80d9-9891-fb83d30538b6" class="">‚Äú–Ø –Ω–µ —Å–º–æ–≥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç, –¥–∞–≤–∞–π –ø–æ–¥–∫–ª—é—á–∏–º —á–µ–ª–æ–≤–µ–∫–∞‚Äù.</blockquote></li></ul><p id="2ab568fa-e39f-801e-b8ab-e06245bda318" class="">–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–¥—É–∫—Ç–µ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –º–æ–∂–Ω–æ:</p><ul id="2ab568fa-e39f-8046-b194-d2e98f6ffad6" class="bulleted-list"><li style="list-style-type:disc">–ø–æ–¥–Ω—è—Ç—å —Ñ–ª–∞–≥ ‚Äú–ø–µ—Ä–µ–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—É‚Äù,</li></ul><ul id="2ab568fa-e39f-8054-a010-d0019a89db29" class="bulleted-list"><li style="list-style-type:disc">–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–æ–π –∫–µ–π—Å.</li></ul><hr id="2ab568fa-e39f-8051-8490-c3517cb23165"/><h2 id="2ab568fa-e39f-8013-9fa9-db49d90e0c45" class="">7. –í–µ–∫—Ç–æ—Ä –Ω–∞ –ø—Ä–æ–¥: —á—Ç–æ –µ—â—ë –º–æ–∂–Ω–æ (–Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ —ç—Ç–æ–º —É—Ä–æ–∫–µ)</h2><p id="2ab568fa-e39f-80b3-8f7b-ed1d12fa0853" class="">–ö–æ—Ä–æ—Ç–∫–æ –Ω–∞–∫–∏–¥–∞—Ç—å –∏–¥–µ–∏, —á—Ç–æ–±—ã —É—á–µ–Ω–∏–∫–∏ –ø–æ–Ω–∏–º–∞–ª–∏, –∫—É–¥–∞ —Ä–∞—Å—Ç–∏—Ç—å:</p><ol type="1" id="2ab568fa-e39f-802f-89cc-d9f34412e13b" class="numbered-list" start="1"><li><strong>–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</strong> –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π:<ul id="2ab568fa-e39f-809e-95f4-fd83d9591571" class="bulleted-list"><li style="list-style-type:disc">–±–∏–ª–ª–∏–Ω–≥ / –±–∞–≥ / –∞–∫–∫–∞—É–Ω—Ç ‚Üí —Ä–∞–∑–Ω—ã–µ ‚Äú—Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã‚Äù –æ—Ç–≤–µ—Ç–æ–≤.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-8068-a0b6-e92fee03078c" class="numbered-list" start="2"><li><strong>Safety-—Ñ–∏–ª—å—Ç—Ä—ã</strong>:<ul id="2ab568fa-e39f-802b-b533-dd2e697ffbe0" class="bulleted-list"><li style="list-style-type:disc">–Ω–µ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≤–Ω–µ –¥–æ–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äúhow to cook pasta?‚Äù) ‚Üí ‚Äú—è —Å–∞–ø–ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ —à–µ—Ñ‚Äù.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-8030-bd65-ef7e9846a0d9" class="numbered-list" start="3"><li><strong>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î/–±—ç–∫–µ–Ω–¥–æ–º</strong>:<ul id="2ab568fa-e39f-8001-9395-c7300f25f481" class="bulleted-list"><li style="list-style-type:disc">–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏, –ø–ª–∞—Ç–µ–∂–∞—Ö –∏ —Ç.–¥.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-8071-b5f0-d68217a0f1dc" class="numbered-list" start="4"><li><strong>–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</strong>:<ul id="2ab568fa-e39f-808b-802e-c2f1fc577202" class="bulleted-list"><li style="list-style-type:disc">–æ–±–µ—Ä–Ω—É—Ç—å —ç—Ç–æ—Ç –±–æ—Ç –≤ –ø—Ä–æ—Å—Ç—É—é –≤–µ–±–∫—É (FastAPI + —Ñ—Ä–æ–Ω—Ç).</li></ul></li></ol><hr id="2ab568fa-e39f-804e-a111-c83eccc7a7f6"/><h2 id="2ab568fa-e39f-807f-a3f5-e01c9b18129a" class="">8. –î–æ–º–∞—à–∫–∞ –ø–æ —É—Ä–æ–∫—É 6.4 (—á—Ç–æ–±—ã –¥–æ–±–∏—Ç—å —Ç–µ–º—É)</h2><h3 id="2ab568fa-e39f-80bc-8b57-fc22139bffdd" class="">–ó–∞–¥–∞–Ω–∏–µ 1. –ü–æ–∏–≥—Ä–∞—Ç—å —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π</h3><ol type="1" id="2ab568fa-e39f-8099-9ebb-e734af66febb" class="numbered-list" start="1"><li>–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ <code>generate_reply</code>:<ul id="2ab568fa-e39f-8076-8e9d-d82b2da5c275" class="bulleted-list"><li style="list-style-type:disc">–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π <code>top_p</code>/<code>temperature</code>,</li></ul><ul id="2ab568fa-e39f-806f-9128-deac82b422f2" class="bulleted-list"><li style="list-style-type:disc">–∑–∞–ø–∏—Å–∞—Ç—å, –ø—Ä–∏ –∫–∞–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –æ—Ç–≤–µ—Ç—ã:<ul id="2ab568fa-e39f-8073-92fe-e6a5d3056b86" class="bulleted-list"><li style="list-style-type:circle">—Å–∞–º—ã–µ ‚Äú–¥–µ–ª–æ–≤—ã–µ‚Äù,</li></ul><ul id="2ab568fa-e39f-805d-8e84-c2522d615c01" class="bulleted-list"><li style="list-style-type:circle">—Å–∞–º—ã–µ ‚Äú—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–µ‚Äù.</li></ul></li></ul></li></ol><hr id="2ab568fa-e39f-80ce-ae07-c52ccbf61143"/><h3 id="2ab568fa-e39f-8091-93fe-f6afc90bacf7" class="">–ó–∞–¥–∞–Ω–∏–µ 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –æ—Ç–≤–µ—Ç–∞</h3><ol type="1" id="2ab568fa-e39f-800e-98d4-ddedff7bc30d" class="numbered-list" start="1"><li>–î–æ–±–∞–≤–∏—Ç—å –≤ <code>generate_reply</code>:<ul id="2ab568fa-e39f-8092-999d-f109c177ca57" class="bulleted-list"><li style="list-style-type:disc">–æ–±—Ä–µ–∑–∫—É –æ—Ç–≤–µ—Ç–∞ –¥–æ N –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (–ø–æ —Ç–æ—á–∫–∞–º/–ø–µ—Ä–µ–Ω–æ—Å–∞–º),</li></ul><ul id="2ab568fa-e39f-80ed-83d9-f920686b74b1" class="bulleted-list"><li style="list-style-type:disc">–∏–ª–∏ –¥–æ N —Å–∏–º–≤–æ–ª–æ–≤.</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-80b5-a4a2-c06e77332af8" class="numbered-list" start="2"><li>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∏ –±–æ—Ç —Å–ª–∏—à–∫–æ–º ‚Äú—Ä—É–±–ª–µ–Ω—ã–º‚Äù.</li></ol><hr id="2ab568fa-e39f-805c-bb59-c74ddcf83df1"/><h3 id="2ab568fa-e39f-800b-acae-df37c919c5b6" class="">–ó–∞–¥–∞–Ω–∏–µ 3. –ü—Ä–æ—Å—Ç–∞—è –º–µ—Ç—Ä–∏–∫–∞ ‚Äú–∫–∞—á–µ—Å—Ç–≤–∞‚Äù –æ—Ç–≤–µ—Ç–∞</h3><ol type="1" id="2ab568fa-e39f-8096-bb11-ea76ee435258" class="numbered-list" start="1"><li>–ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é:<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2ab568fa-e39f-804d-a666-ea736b0bf389" class="code code-wrap"><code class="language-Python" style="white-space:pre-wrap;word-break:break-all">def is_bad_reply(reply: str) -&gt; bool:
    ...
</code></pre><p id="2ab568fa-e39f-80b2-9428-c582892926fd" class="">–∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç <code>True</code>, –µ—Å–ª–∏:</p><ul id="2ab568fa-e39f-809c-9efd-e924f5fcffcd" class="bulleted-list"><li style="list-style-type:disc">—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ (<code>len(reply) &lt; 10</code>),</li></ul><ul id="2ab568fa-e39f-80e6-afab-fc491aa39550" class="bulleted-list"><li style="list-style-type:disc">–∏–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ (<code>&quot;...&quot;</code> –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏ —Ç.–ø.).</li></ul></li></ol><ol type="1" id="2ab568fa-e39f-8077-b592-dcfdd8348fe6" class="numbered-list" start="2"><li>–í <code>chat()</code>:<ul id="2ab568fa-e39f-8026-90f2-cd6215f7f5b0" class="bulleted-list"><li style="list-style-type:disc">–µ—Å–ª–∏ <code>is_bad_reply(reply)</code> ‚Üí –≤—ã–≤–æ–¥–∏—Ç—å fallback (‚Äú–ø–µ—Ä–µ–¥–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—É‚Äù).</li></ul></li></ol><hr id="2ab568fa-e39f-80b2-a91f-f3c78e3cc7a8"/><p id="2ab568fa-e39f-806f-8aa5-e13c6d745638" class="">–ù–∞ —ç—Ç–æ–º –º–æ–¥—É–ª–µ 6 —Ç—ã –¥–æ–≤—ë–ª –∏—Å—Ç–æ—Ä–∏—é —Å Causal LM –¥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –º–∏–Ω–∏-—Ñ–∏–Ω–∏—à–∞:</p><ul id="2ab568fa-e39f-8028-9c9f-e787f230e7b3" class="bulleted-list"><li style="list-style-type:disc">SFT-–º–æ–¥–µ–ª—å –ø–æ —Å–≤–æ–∏–º –¥–∏–∞–ª–æ–≥–∞–º,</li></ul><ul id="2ab568fa-e39f-8080-be34-c845c9a53365" class="bulleted-list"><li style="list-style-type:disc">—á–∞—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π,</li></ul><ul id="2ab568fa-e39f-80f3-9ea7-c9569c0e5954" class="bulleted-list"><li style="list-style-type:disc">—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.</li></ul><p id="2ab568fa-e39f-80b6-986c-cd9f678cc6b9" class="">–î–∞–ª—å—à–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:</p><ul id="2ab568fa-e39f-8079-ad26-e0a98f017513" class="bulleted-list"><li style="list-style-type:disc"><strong>7 ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ</strong> (quantization, <code>accelerate</code>, device_map),</li></ul><ul id="2ab568fa-e39f-8087-86d1-e6d6732a36b2" class="bulleted-list"><li style="list-style-type:disc"><strong>8 ‚Äî PEFT/LoRA</strong>, —á—Ç–æ–±—ã —É—á–∏—Ç—å —Ç–∞–∫–∏–µ —à—Ç—É–∫–∏ –¥–µ—à–µ–≤–ª–µ –∏ –Ω–∞ –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö.</li></ul><p id="2ab568fa-e39f-80ba-b99c-fb4aeb4d2349" class="">–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –∫–∞–∫ —Ä–∞–∑ —Ä–∞—Å–ø–∏—Å–∞—Ç—å –º–æ–¥—É–ª—å 7 (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è/—É—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏) –∏–ª–∏ –ø–æ–º–æ—á—å —Å–æ–±—Ä–∞—Ç—å –∏–∑ –º–æ–¥—É–ª–µ–π 0‚Äì6 –∫—Ä–∞—Å–∏–≤—ã–π syllabus –¥–ª—è –ª–µ–Ω–¥–∏–Ω–≥–∞ –∫—É—Ä—Å–∞.</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>